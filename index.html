<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>Sim File Parser</title>
 
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>

  <body>
	<input type="file" id="file_selector" onchange="handleFile()"></input>
	

	
	<div id="section_metadata">
		<div id="song_metadata">
			<table class="metadata_table">
				<tr>
					<td class="metadata_label">Title</td>
					<td id="md_title" class="metadata">empty title</td>
				</tr>
				<tr>
					<td class="metadata_label">Subtitle</td>
					<td id="md_subtitle" class="metadata">empty subtitle</td>
				</tr>
				<tr>
					<td class="metadata_label">Artist</td>
					<td id="md_artist" class="metadata">empty artist</td>
				</tr>
			</table>
		</div>
		
		<div id="difficulty_metadata">
			<table class="metadata_table">
				<tr>
					<td class="metadata_label">Difficulty</td>
					<td class="metadata">
						<select id="md_difficulty_picker" onchange="difficultySelected()">
							<option>None</option>
						</select>
					</td>
				</tr>
			</table>
		</div>
	</div>
	
	<div id="draw_area">
<!-- 		<table id="test" class="stepchart"> -->
<!-- 			<tr> -->
<!-- 				<td><img class="l" src="assets/4th.png"></td> -->
<!-- 				<td><img class="d" src="assets/4th.png"></td> -->
<!-- 				<td><img class="u" src="assets/4th.png"></td> -->
<!-- 				<td><img class="r" src="assets/4th.png"></td> -->
<!-- 			</tr> -->
<!-- 			<tr> -->
<!-- 				<td></td>  -->
<!-- 				<td></td> -->
<!-- 				<td><img class="u" src="assets/4th.png"></td> -->
<!-- 				<td><img class="r" src="assets/4th.png"></td> -->
<!-- 			</tr> -->
<!-- 			<tr> -->
<!-- 				<td></td>  -->
<!-- 				<td><img class="d" src="assets/4th.png"></td> -->
<!-- 				<td><img class="u" src="assets/4th.png"></td> -->
<!-- 				<td></td> -->
<!-- 			</tr> -->
<!-- 			<tr> -->
<!-- 				<td></td>  -->
<!-- 				<td><img class="d" src="assets/4th.png"></td> -->
<!-- 				<td></td> -->
<!-- 				<td></td> -->
<!-- 			</tr> -->
<!-- 		</table> -->
		
	</div>
	
	<script src="src/SMP.js"></script>
	<script src="src/util/parser.js"></script>
	<script src="src/ui/stepchart-generator.js"></script>
	<script src="src/ui/metadata-manager.js"></script>
	<script src="src/models/sim-file.js"></script>

	<script>
		function difficultySelected() {
			if (simFile) {
				var selectionIndex = document.getElementById("md_difficulty_picker").selectedIndex;
				displayDifficulty(selectionIndex);
			}
		}
	
		function handleFile() {
			getFileContents();
		}
		
		function getFileContents() {
			input = document.getElementById('file_selector');
			file = input.files[0];
			fr = new FileReader();
			fr.onload = fileFinishedLoading;
			fr.readAsText(file);
		}
		
		function fileFinishedLoading() {       
	        simFile = parser.parseSimFileContents(fr.result);
	        if (simFile) {	        	
           		displayDifficulty(6);
	        }
           	
           	metadataManager.populateSongMetadataSection(simFile);
           	metadataManager.populateDifficultySection(simFile);
		 }
		
		function displayDifficulty(difficultyIndex) {
			var table = stepChartGenerator.getStepChartTable(simFile, difficultyIndex);
			table.id = "targetchart";
		
			var style = stepChartGenerator.getStepChartStyleSheet(simFile, 60, "targetchart");
			style.id = "targetchart_style";
			
			SMP.removeElementById("targetchart");
			SMP.removeElementById("targetchart_style");
			
			var drawArea = document.getElementById("draw_area");
			drawArea.appendChild(table);
			document.head.appendChild(style);
			
			console.log("showing difficulty " + simFile.difficulties[difficultyIndex].toString());
		}
        
	</script>
  </body>
</html>